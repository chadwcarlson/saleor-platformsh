- name: 'saleor'

  type: 'python:3.8'

  variables:
      env:
          AUTO_UPDATES:
              saleor: 
                  version: '2.11.8'
                  upstream: 'mirumee/saleor'
              poetry:
                  version: '1.1.6'
                  upstream: 'python-poetry/poetry'

  hooks:
      build: |
          set -e 

          # Get Poetry.
          POETRY_UPSTREAM=$(echo $AUTO_UPDATES | jq -r '.poetry.upstream')
          POETRY_VERSION=$(echo $AUTO_UPDATES | jq -r '.poetry.version')
          curl -s https://raw.githubusercontent.com/$POETRY_UPSTREAM/master/get-poetry.py >> get-poetry.py
          python get-poetry.py --version $POETRY_VERSION

          # Get Saleor.
          SALEOR_UPSTREAM=$(echo $AUTO_UPDATES | jq -r '.saleor.upstream')
          SALEOR_VERSION=$(echo $AUTO_UPDATES | jq -r '.saleor.version')
          wget --quiet -c https://github.com/$SALEOR_UPSTREAM/archive/refs/tags/$SALEOR_VERSION.tar.gz -O - | tar -xz
          mv saleor-$SALEOR_VERSION saleor

  web:
      commands:
          # Run a no-op process that uses no CPU resources, since this is a static site.
          start: sleep infinity

      locations:
          # This tells Nginx to serve from the base directory
          "/":
              root: "web"
              index:
                  - "index.html"
